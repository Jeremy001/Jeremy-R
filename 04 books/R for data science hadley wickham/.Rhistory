?apply
?trimw
?trim
??trim
?tapply
n <- 17; fac <- factor(rep(1:3, length = n), levels = 1:5)
table(fac)
tapply(1:n, fac, sum)
fac
# 将当前文件所在的路径设置为工作目录
library('rstudioapi')
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# 加载包
library(tidyverse)
library(nycflights13)
data(flights)
not_cancelled_flights <- flights %>%
filter(!is.na(dep_delay),
!is.na(arr_delay))
not_cancelled_flights %>%
group_by(year, month, day) %>%
summarise(first_flight = min(dep_time),
last_flight = max(dep_time))
flights %>%
filter(year == 2013,
month = 1,
day = 1)
flights %>%
filter(year == 2013,
month == 1,
day == 1)
flights %>%
arrange(year, month, day, -dep_time) %>%
group_by(year, month, day) %>%
summarise(first_dep = first(dep_time),
last_dep = last(dep_time))
flights %>%
filter(!is.na(dep_time)) %>%
arrange(year, month, day, -dep_time) %>%
group_by(year, month, day) %>%
summarise(first_dep = first(dep_time),
last_dep = last(dep_time))
flights %>%
filter(!is.na(dep_time)) %>%
arrange(year, month, day, dep_time) %>%
group_by(year, month, day) %>%
summarise(first_dep = first(dep_time),
last_dep = last(dep_time))
source('E:/R/Jeremy-R/04 books/R for data science hadley wickham/R4ds05 data transformation.r', encoding = 'UTF-8', echo=TRUE)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(year, month, day) %>%
mutate(r = min_rank(desc(dep_time))) %>%
filter(r %in% range(r))
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(year, month, day) %>%
mutate(r = min_rank(desc(dep_time))) %>%
filter(r %in% range(r))
test <- flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(year, month, day) %>%
mutate(r = min_rank(desc(dep_time))) %>%
filter(r %in% range(r))
test
View(test)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(dest) %>%
summarise(carriers = n_distinct(carrier)) %>%
arrange(desc(carriers))
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
count(dest)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
count(dest) %>%
arrange(-n)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
count(year, month, day) %>%
arrange(-n)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
count(year, month, day)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
count(tailnum, wt = distance) %>%
arrange(-n)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(year, month, day) %>%
summarise(dep_all = n(),
dep_5_n = sum(dep_time < 500),
dep_5_p = mean(dep_time < 500)) %>%
arrange(-dep_5_p)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(year, month, day) %>%
summarise(flights = n())
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(year, month, day) %>%
summarise(flights = n()))
(per_day <-
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(year, month, day) %>%
summarise(flights = n()))
(per_month <- summarise(per_day, fligts = sum(flights)))
(per_month <- summarise(per_day, flights = sum(flights)))
(per_year <- summarise(per_month, flights = sum(flights)))
(per_year <- summarise(per_month, flights = sum(flights)))
daily <- group_by(flights, year, month, day)
daily %>%
ungroup() %>%
summarise(flights = n())
daily %>%
ungroup() %>%
summarise(n = n())
sum(is.na(dep_time))
sum(is.na(flights$dep_time))
sum(is.na(flights$arr_time))
flights %>%
filter(!is.na(dep_time),
is.na(arr_time)) %>%
flights %>%
filter(!is.na(dep_time),
is.na(arr_time))
str(flights)
?flights
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
early15_n = sum(dep_delay == -15),
early15_p = mean(dep_delay == -15),
late15_n = sum(dep_delay == 15),
early15_p = mean(dep_delay == 15))
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
early15_n = sum(dep_delay == -15),
early15_p = mean(dep_delay == -15),
late15_n = sum(dep_delay == 15),
late15_p = mean(dep_delay == 15))
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
early15_n = sum(dep_delay == -15),
early15_p = mean(dep_delay == -15),
late15_n = sum(dep_delay == 15),
late15_p = mean(dep_delay == 15)) %>%
filter(near(early15_p, 0.15))
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
early15_n = sum(dep_delay <= -15),
early15_p = mean(dep_delay <= -15),
late15_n = sum(dep_delay >= 15),
late15_p = mean(dep_delay >= 15)) %>%
filter(near(early15_p, 0.15))
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
late10_n = sum(dep_delay == 10),
late10_p = mean(dep_delay == 10)) %>%
arrange(-late10_p)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
late10_n = sum(dep_delay == 10),
late10_p = mean(dep_delay == 10)) %>%
arrange(-late10_p) %>%
filter(n >= 2, late10_p >= 0.33)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
ontime_n = sum(dep_delay == 0),
ontime_p = mean(dep_delay == 0))
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
ontime_n = sum(dep_delay == 0),
ontime_p = mean(dep_delay == 0)) %>%
arrange(-ontime_p)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
ontime_n = sum(dep_delay == 0),
ontime_p = mean(dep_delay == 0)) %>%
arrange(-ontime_p) %>%
filter(n >= 10)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
ontime_n = sum(dep_delay == 0),
ontime_p = mean(dep_delay == 0)) %>%
filter(-ontime_p >= 0.99) %>%
arrange(-ontime_p) %>%
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
ontime_n = sum(dep_delay == 0),
ontime_p = mean(dep_delay == 0)) %>%
filter(-ontime_p >= 0.99) %>%
arrange(-ontime_p)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(flight) %>%
summarise(n = n(),
ontime_n = sum(dep_delay == 0),
ontime_p = mean(dep_delay == 0)) %>%
filter(ontime_p >= 0.99) %>%
arrange(-ontime_p)
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(dest) %>%
summarise(n = n())
flights %>%
filter(!is.na(dep_time),
!is.na(arr_time)) %>%
group_by(tailnum) %>%
summarise(dist = sum(distance))
flights %>%
group_by(year.month, day) %>%
summarise(cancel_n = sum(is.na(arr_time)))
flights %>%
group_by(year, month, day) %>%
summarise(cancel_n = sum(is.na(arr_time)))
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)))
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(ia.na(arr_time)))
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)))
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE))
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-'))
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
select(-(year:day))
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
ggplot(mapping = aes(x = date, y = cancel_p)) +
geom_point()
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
ggplot(mapping = aes(x = date, y = cancel_p)) +
geom_line()
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
ggplot(mapping = aes(x = date, y = cancel_p)) +
geom_point()
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
filter(month == 1) %>%
ggplot(mapping = aes(x = date, y = cancel_p)) +
geom_point()
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
filter(month == 1) %>%
ggplot(mapping = aes(x = date, y = cancel_n)) +
geom_point()
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
filter(month == 1) %>%
ggplot(mapping = aes(x = arr_delay_mean, y = cancel_n)) +
geom_point()
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
filter(month == 1) %>%
ggplot(mapping = aes(x = arr_delay_mean, y = cancel_n)) +
geom_point() %>%
geom_smooth(se = FALSE)
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
filter(month == 1) %>%
ggplot() +
geom_point(mapping = aes(x = arr_delay_mean, y = cancel_n)) %>%
geom_smooth(se = FALSE)
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
filter(month == 1) %>%
ggplot(mapping = aes(x = arr_delay_mean, y = cancel_n)) +
geom_point() +
geom_smooth(se = FALSE)
flights %>%
group_by(year, month, day) %>%
summarise(n = n(),
cancel_n = sum(is.na(arr_time)),
cancel_p = mean(is.na(arr_time)),
arr_delay_mean = mean(arr_delay, na.rm = TRUE)) %>%
mutate(date = paste(year, month, day, sep = '-')) %>%
# filter(month == 1) %>%
ggplot(mapping = aes(x = arr_delay_mean, y = cancel_n)) +
geom_point() +
geom_smooth(se = FALSE)
flights %>%
group_by(month) %>%
filter(rank(desc(arr_delay)) < 10)
flights %>%
group_by(month) %>%
filter(rank(desc(arr_delay)) < 4)
flights %>%
group_by(dest) %>%
filter(n() > 365)
flights %>%
group_by(dest) %>%
filter(n() > 365) %>%
filter(arr_delay > 0) %>%
mutate(delay_prop = arr_delay / sum(arr_delay))
flights %>%
group_by(dest) %>%
filter(n() > 365) %>%
filter(arr_delay > 0) %>%
mutate(delay_prop = arr_delay / sum(arr_delay)) %>%
select(dest, arr_delay, delay_prop)
flights %>%
group_by(dest) %>%
filter(n() > 365) %>%
filter(arr_delay > 0) %>%
group_by(dest) %>%
mutate(arr_delay = sum(arr_delay))
flights %>%
group_by(dest) %>%
filter(n() > 365) %>%
filter(arr_delay > 0) %>%
count(dest, wt = arr_delay)
count(flights$dest)
str(flights)
flights %>%
count(dest)
flights %>%
summarise(n = n_distinct(dest))
flights %>%
group_by(dest) %>%
filter(n() > 365)
flights %>%
group_by(dest) %>%
filter(n() > 365) %>%
filter(arr_delay > 0)
flights %>%
group_by(dest) %>%
filter(n() > 365) %>%
filter(arr_delay > 0) %>%
group_by(dest) %>%
mutate(arr_delay = sum(arr_delay))
flights %>%
group_by(dest) %>%
filter(n() > 365) %>%
filter(arr_delay > 0) %>%
count(dest, wt = arr_delay)
flights %>%
group_by(dest) %>%
filter(n() > 365) %>%
filter(arr_delay > 0) %>%
summarise(n = n_distinct(dest))
flights %>%
group_by(dest) %>%
filter(n() > 365) %>%
filter(arr_delay > 0) %>%
count(dest, wt = arr_delay) %>%
mutate(arr_delay = n / sum(n))
flights %>%
group_by(dest) %>%
filter(n() > 365) %>%
filter(arr_delay > 0) %>%
count(dest, wt = arr_delay) %>%
mutate(delay_t = n, delay_prop = n / sum(n)) %>%
arrange(-delay_prop)
vignette('window-function')
vignette('window-functions')
